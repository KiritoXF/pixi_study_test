<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Hello World</title>
    </head>
    <script src="src/assets/js/pixi.min.js"></script>
    <body>
        <script type="text/javascript">
            // 定义别名
            let Application = PIXI.Application,
                loader = PIXI.loader,
                resources = PIXI.loader.resources,
                Sprite = PIXI.Sprite,
                TextureCache = PIXI.utils.TextureCache,
                Rectangle = PIXI.Rectangle;

            //Create a Pixi Application
            let app = new Application({
                width: 256,
                height: 256,
                antialiase: true,
                transparent: false,
                resolution: 1
            });

            let dungeon, explorer, treasure, door, id;

            document.body.appendChild(app.view);

            // 设置大小
            app.renderer.backgroundColor = 0x91B493;
            app.renderer.autoResize = true;
            app.renderer.resize(512, 512);

            // 全屏
            app.renderer.view.style.position = "absolute";
            app.renderer.view.style.display = "block";
            app.renderer.autoResize = true;
            app.renderer.resize(window.innerWidth, window.innerHeight);

            // 
            /* let base = new PIXI.BaseTexture(texture),
                texture = new PIXI.Texture(base),
                sprite = new PIXI.Sprite(texture); */

            // 创建纹理
            //let base = new PIXI.BaseTexture.fromCanvas(//);


            //Add the canvas that Pixi automatically created for you to the HTML document
            // 监视加载进程,每次文件加载(此处为catImage文件)时调用loadProgressHandler

            loader
                .add("catImage", "src/assets/images/cat.png", finishFunction)
                .add("src/assets/images/tileset.png")
                .add("src/assets/images/treasureHunter.json")
                .on("progress", loadProgressHandler)
                .load(setup);


            function loadProgressHandler(loader, resource) {
                // 可以显示加载的百分比,但实际上只有加载完才会打印一个100%.
                // 应该是总的加载进度
                console.log("loading: " + resource.url);
                console.log("progress: " + loader.progress + "%");
            };

            function finishFunction() {
                console.log("loader.add has been completed");

            };

            function setup() {
                // 创建图片精灵
                let texture = PIXI.utils.TextureCache["src/assets/images/cat.png"];

                // 精灵
                let cat = new Sprite(
                    resources["catImage"].texture)
                // 添加精灵
                //app.stage.addChild(cat);
                // 移除精灵
                //app.stage.removeChild(cat);
                //cat.visible = false; // 或者隐藏它
                console.log("All files loaded");

                // 几种loader.add的语法
                /* loader.reset().add({
                    name: 'key1',
                    url: 'https://www.baidu.com'
                }, function() {});
                
                loader.add({
                    name: 'key2',
                    url: 'https://www.baidu.com',
                    onComplete: function () {}
                });
                
                loader.add({
                    url: 'https://www.baidu.com',
                    onComplete: function () {},
                    crossOrigin: true
                }) */

                // 精灵位置
                cat.position.set(96, 96);
                // 比例
                cat.scale.set(1.5, 1.5);
                // 旋转
                cat.rotation = 0.1415926;
                // 设置锚点
                cat.anchor.set(0.5, 0.5);
                // 设置原点
                //cat.pivot.set(32, 32);

                // 雪碧图
                let tileset = TextureCache["src/assets/images/tileset.png"];
                let rectangle = new Rectangle(192, 128, 64, 64);
                tileset.frame = rectangle;
                let rocket = new Sprite(tileset);
                rocket.x = 32;
                rocket.y = 32;
                //app.stage.addChild(rocket);
                app.renderer.render(app.stage);

                // 给纹理贴图集取别名
                // 开始创建地牢
                id = PIXI.loader.resources["src/assets/images/treasureHunter.json"].textures;

                treasure = new Sprite(id["treasure.png"]);
                dungeon = new Sprite(id["dungeon.png"]);
                explorer = new Sprite(id["explorer.png"]);
                door = new Sprite(id["door.png"]);

                app.stage.addChild(dungeon);
                app.stage.addChild(treasure);
                app.stage.addChild(explorer);
                app.stage.addChild(door);

                explorer.position.set(68, app.stage.height / 2 - explorer.height / 2);
                treasure.position.set(app.stage.width - treasure.width - 48, app.stage.height / 2 - treasure.height / 2);
                door.position.set(door.width, 0);

                // 添加怪物
                let blobNum = 6,
                    spacing = 48,
                    offset = explorer.x + spacing;
                for (let i = 0; i < blobNum; i++) {
                    let blob = new Sprite(id["blob.png"]);
                    let x = spacing * i + offset;
                    let y = randomInt(offset, app.stage.height - blob.height);
                    blob.position.set(x, y);
                    app.stage.addChild(blob);
                };

                function randomInt(min, max) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }



            };
        </script>
    </body>
</html>
<style>
    * {
        padding: 0;
        margin: 0
    }
</style>
